<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="telegram-web-app-app-id" content="-48192244">
    <title>CloneX</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- TON Connect SDK - Fixed with specific version -->
    <script src="https://unpkg.com/@tonconnect/sdk@1.2.1/dist/tonconnect-sdk.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --font: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --bg-primary: #0A0B14;
            --bg-secondary: #12131D;
            --bg-tertiary: #1A1B26;
            --primary: #00D8FF;
            --secondary: #8C52FF;
            --accent: #FF36AB;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0C0;
            --text-muted: #6A6A8A;
            --card-bg: rgba(25, 26, 35, 0.8);
            --card-border: rgba(105, 111, 255, 0.15);
            --success: #00F0A0;
            --warning: #FFB800;
            --danger: #FF4B4B;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --t: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 8px 15px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 12px 25px rgba(0, 0, 0, 0.4);
            --glow-primary: 0 0 20px rgba(0, 216, 255, 0.4);
            --glow-secondary: 0 0 20px rgba(140, 82, 255, 0.4);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--secondary));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--accent));
            --gradient-bg: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-primary) 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            margin: 0;
            font-family: var(--font);
            background: var(--gradient-bg);
            color: var(--text-primary);
            overflow: hidden;
        }

        /* Background Effects */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.05;
            filter: blur(40px);
        }

        .circle-1 {
            width: 300px;
            height: 300px;
            background: var(--primary);
            top: -150px;
            left: -150px;
            animation: float 25s ease-in-out infinite;
        }

        .circle-2 {
            width: 500px;
            height: 500px;
            background: var(--secondary);
            bottom: -250px;
            right: -250px;
            animation: float 30s ease-in-out infinite reverse;
        }

        .circle-3 {
            width: 200px;
            height: 200px;
            background: var(--accent);
            top: 50%;
            left: 70%;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-20px, 20px) rotate(5deg); }
            50% { transform: translate(10px, -15px) rotate(-5deg); }
            75% { transform: translate(15px, 10px) rotate(3deg); }
        }

        /* App Container */
        .app {
            width: 100%;
            max-width: 480px;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: rgba(10, 11, 20, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        /* Header Section */
        .header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 10;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--t);
        }

        .user-profile:active {
            transform: scale(0.95);
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            box-shadow: var(--glow-primary);
            object-fit: cover;
            transition: var(--t);
        }

        .user-profile:hover .user-avatar {
            box-shadow: 0 0 20px rgba(0, 216, 255, 0.6);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .username {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .user-level {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .level-badge {
            background: var(--gradient-primary);
            color: white;
            padding: 2px 6px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .action-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--t);
            position: relative;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: rgba(40, 42, 58, 0.8);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 18px;
            height: 18px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            font-size: 0.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px var(--accent);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            padding: 12px 20px;
            background: var(--card-bg);
            margin: 0 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow-sm);
            position: relative;
            z-index: 5;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .stat-icon {
            font-size: 1rem;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Balance Section */
        .balance-section {
            padding: 20px;
            text-align: center;
            position: relative;
            z-index: 5;
        }

        .balance-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .balance-amount {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            text-shadow: 0 0 20px rgba(0, 216, 255, 0.4);
        }

        .currency-icon {
            width: 48px;
            height: 48px;
            animation: pulse 2s infinite;
            filter: drop-shadow(0 0 10px rgba(0, 216, 255, 0.5));
        }

        /* Main Game Area */
        .game-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .mining-object {
            width: 280px;
            height: 280px;
            position: relative;
            z-index: 5;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .mining-object:active {
            transform: scale(0.95);
        }

        .mining-core {
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 50px rgba(0, 216, 255, 0.4),
                        inset 0 0 50px rgba(255, 255, 255, 0.1);
            animation: glow 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .mining-core-inner {
            width: 90%;
            height: 90%;
            background: var(--bg-secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            position: relative;
            overflow: hidden;
        }

        .mining-core-inner::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }

        .cx-logo {
            width: 60%; /* Increased from 40% to 60% */
            height: auto;
            filter: drop-shadow(0 0 15px rgba(0, 216, 255, 0.6));
        }

        .multiplier-badge {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-secondary);
            color: white;
            font-size: 0.9rem;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 20px;
            box-shadow: var(--glow-secondary);
            z-index: 10;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 50px rgba(0, 216, 255, 0.4), inset 0 0 50px rgba(255, 255, 255, 0.1); }
            50% { box-shadow: 0 0 70px rgba(0, 216, 255, 0.6), inset 0 0 60px rgba(255, 255, 255, 0.15); }
        }

        .particle-effects {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        .tap-effects {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
        }

        .tap-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 216, 255, 0.4) 0%, transparent 70%);
            transform: translate(-50%, -50);
            opacity: 0;
            animation: tap-animation 0.5s ease-out forwards;
        }

        @keyframes tap-animation {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            pointer-events: none;
            opacity: 0;
            animation: particle-animation 1s ease-out forwards;
        }

        @keyframes particle-animation {
            0% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)); opacity: 0; }
        }

        /* Energy Bar */
        .energy-section {
            padding: 0 20px 20px;
            position: relative;
            z-index: 5;
        }

        .energy-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .energy-bar {
            width: 100%;
            height: 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .energy-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 20px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 216, 255, 0.4);
            position: relative;
            overflow: hidden;
        }

        .energy-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Navigation */
        .nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: var(--card-bg);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding: 16px 0;
            position: relative;
            z-index: 10;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--t);
            position: relative;
            padding: 8px 16px;
            border-radius: var(--radius-md);
        }

        .nav-item:hover {
            color: var(--primary);
            transform: translateY(-2px);
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(0, 216, 255, 0.1);
        }

        .nav-icon {
            font-size: 1.3rem;
            transition: var(--t);
        }

        .nav-label {
            font-size: 0.75rem;
            font-weight: 500;
            transition: var(--t);
        }

        .nav-item:hover .nav-icon {
            transform: scale(1.1);
        }

        .nav-item.active .nav-icon {
            animation: bounce 2s infinite;
        }

        /* Premium Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            z-index: 1000;
            pointer-events: none;
        }

        .toast {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-lg);
            max-width: 90%;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .toast-success .toast-icon {
            color: var(--success);
        }

        .toast-error .toast-icon {
            color: var(--danger);
        }

        .toast-warning .toast-icon {
            color: var(--warning);
        }

        .toast-info .toast-icon {
            color: var(--primary);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--t);
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .toast-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
            padding: 20px;
        }

        .modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 440px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .modal-title {
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--t);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 12px 20px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--t);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shine 2s infinite;
            pointer-events: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--card-border);
        }

        .btn-secondary::before {
            display: none;
        }

        .btn-lg {
            padding: 16px 24px;
            font-size: 1rem;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-icon {
            font-size: 1.1rem;
        }

        /* Shop Items */
        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .shop-item {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: var(--t);
            border: 1px solid var(--card-border);
        }

        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--glow-primary);
        }

        .shop-item-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .shop-item-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .shop-item-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .shop-item-price {
            font-weight: 700;
            color: var(--primary);
            margin-top: auto;
        }

        /* Boost Items */
        .boost-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .boost-item {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--t);
            border: 1px solid var(--card-border);
        }

        .boost-item:hover {
            transform: translateX(5px);
            box-shadow: var(--glow-secondary);
        }

        .boost-item-icon {
            font-size: 1.5rem;
            color: var(--secondary);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(140, 82, 255, 0.1);
            border-radius: 50%;
        }

        .boost-item-content {
            flex: 1;
        }

        .boost-item-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .boost-item-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .boost-item-action {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
        }

        /* Task Items */
        .task-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-item {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--t);
            border: 1px solid var(--card-border);
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: var(--glow-primary);
        }

        .task-item-check {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .task-item-check.completed {
            background: var(--primary);
        }

        .task-item-check.completed::before {
            content: '✓';
            color: white;
            font-size: 0.8rem;
        }

        .task-item-content {
            flex: 1;
        }

        .task-item-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .task-item-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .task-item-reward {
            font-weight: 700;
            color: var(--primary);
        }

        /* Leaderboard */
        .leaderboard {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .leaderboard-item {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--t);
            border: 1px solid var(--card-border);
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
        }

        .leaderboard-rank {
            font-weight: 700;
            width: 24px;
            text-align: center;
        }

        .leaderboard-item:nth-child(1) .leaderboard-rank {
            color: gold;
        }

        .leaderboard-item:nth-child(2) .leaderboard-rank {
            color: silver;
        }

        .leaderboard-item:nth-child(3) .leaderboard-rank {
            color: #cd7f32; /* Bronze */
        }

        .leaderboard-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .leaderboard-value {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .leaderboard-score {
            font-weight: 700;
            color: var(--primary);
        }

        /* Wallet Connection */
        .wallet-connected {
            position: relative;
        }

        .wallet-connected::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            border: 2px solid var(--bg-primary);
        }

        /* Wallet Modal Specific Styles */
        .wallet-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .wallet-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            border: 1px solid var(--card-border);
            cursor: pointer;
            transition: var(--t);
        }

        .wallet-option:hover {
            transform: translateX(5px);
            box-shadow: var(--glow-primary);
        }

        .wallet-option-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 216, 255, 0.1);
            border-radius: 50%;
        }

        .wallet-option-content {
            flex: 1;
            pointer-events: none;
        }

        .wallet-option-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .wallet-option-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .wallet-option-action {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 600;
            pointer-events: auto;
        }

        /* Notifications */
        .notification-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .notification-item {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transition: var(--t);
            border: 1px solid var(--card-border);
        }

        .notification-item.unread {
            border-left: 4px solid var(--primary);
        }

        .notification-item:hover {
            transform: translateX(5px);
        }

        .notification-icon {
            font-size: 1.2rem;
            color: var(--primary);
            margin-top: 2px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .notification-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Currency badges */
        .currency-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .ton-badge {
            color: #0088cc;
        }

        .star-badge {
            color: #FFD700;
        }

        .cx-badge {
            color: var(--primary);
        }

        /* Responsive adjustments */
        @media (max-height: 700px) {
            .mining-object {
                width: 220px;
                height: 220px;
            }
            
            .balance-amount {
                font-size: 2rem;
            }
            
            .currency-icon {
                width: 40px;
                height: 40px;
            }
            
            .header {
                padding: 15px;
            }
            
            .stats-bar {
                padding: 10px 15px;
                margin: 0 15px;
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }
    </style>
</head>
<body>
    <div class="bg-effects">
        <div class="bg-circle circle-1"></div>
        <div class="bg-circle circle-2"></div>
        <div class="bg-circle circle-3"></div>
    </div>

    <div class="toast-container" id="toastContainer">
        <div class="toast" id="toast">
            <div class="toast-icon"><i class="fas fa-info-circle"></i></div>
            <div class="toast-content">
                <div class="toast-title">Information</div>
                <div class="toast-message">This is a notification message</div>
            </div>
            <button class="toast-close">&times;</button>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="walletModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Connect Wallet</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="wallet-options">
                    <div class="wallet-option" id="tonKeeperOption">
                        <div class="wallet-option-icon"><i class="fas fa-wallet"></i></div>
                        <div class="wallet-option-content">
                            <div class="wallet-option-title">Tonkeeper</div>
                            <div class="wallet-option-desc">Connect using Tonkeeper wallet</div>
                        </div>
                        <div class="wallet-option-action" id="connectTonKeeper">Connect</div>
                    </div>
                    <div class="wallet-option" id="tonHubOption">
                        <div class="wallet-option-icon"><i class="fas fa-wallet"></i></div>
                        <div class="wallet-option-content">
                            <div class="wallet-option-title">TonHub</div>
                            <div class="wallet-option-desc">Connect using TonHub wallet</div>
                        </div>
                        <div class="wallet-option-action" id="connectTonHub">Connect</div>
                    </div>
                    <div class="wallet-option" id="telegramWalletOption">
                        <div class="wallet-option-icon"><i class="fab fa-telegram"></i></div>
                        <div class="wallet-option-content">
                            <div class="wallet-option-title">Telegram Wallet</div>
                            <div class="wallet-option-desc">Connect using Telegram built-in wallet</div>
                        </div>
                        <div class="wallet-option-action" id="connectTelegramWallet">Connect</div>
                    </div>
                </div>
                <div id="walletConnectionStatus" style="margin-top: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: var(--radius-md); display: none;">
                    <h4 style="margin-bottom: 10px;">Connection Status</h4>
                    <div id="walletStatusText">Connecting...</div>
                    <div class="spinner" style="margin: 10px auto;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeWalletModal">Cancel</button>
                <button class="btn" id="disconnectWallet" style="display: none;">Disconnect</button>
            </div>
        </div>
    </div>

    <div class="modal" id="boostsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Boosts</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="boost-items">
                    <div class="boost-item" data-id="energyRegen" data-price="500" data-currency="cx">
                        <div class="boost-item-icon"><i class="fas fa-bolt"></i></div>
                        <div class="boost-item-content">
                            <div class="boost-item-title">Energy Regen Boost</div>
                            <div class="boost-item-desc">Increase energy regeneration by 0.2/s</div>
                        </div>
                        <div class="boost-item-action">
                            <span class="currency-badge cx-badge"><i class="fas fa-coins"></i> 500 CX</span>
                        </div>
                    </div>
                    <div class="boost-item" data-id="multitap" data-price="1000" data-currency="cx">
                        <div class="boost-item-icon"><i class="fas fa-hand-point-up"></i></div>
                        <div class="boost-item-content">
                            <div class="boost-item-title">Multitap Upgrade</div>
                            <div class="boost-item-desc">Get +1 tap per click</div>
                        </div>
                        <div class="boost-item-action">
                            <span class="currency-badge cx-badge"><i class="fas fa-coins"></i> 1000 CX</span>
                        </div>
                    </div>
                    <div class="boost-item" data-id="multiplier" data-price="2000" data-currency="cx">
                        <div class="boost-item-icon"><i class="fas fa-gem"></i></div>
                        <div class="boost-item-content">
                            <div class="boost-item-title">2x Multiplier</div>
                            <div class="boost-item-desc">Double your earnings for 30 minutes</div>
                        </div>
                        <div class="boost-item-action">
                            <span class="currency-badge cx-badge"><i class="fas fa-coins"></i> 2000 CX</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeBoostsModal">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="shopModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Premium Shop</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shop-items">
                    <div class="shop-item" data-id="energyPack" data-price="200" data-currency="cx">
                        <div class="shop-item-icon"><i class="fas fa-bolt"></i></div>
                        <div class="shop-item-title">Energy Pack</div>
                        <div class="shop-item-desc">Instantly refill your energy</div>
                        <div class="shop-item-price">
                            <span class="currency-badge cx-badge"><i class="fas fa-coins"></i> 200 CX</span>
                        </div>
                    </div>
                    <div class="shop-item" data-id="starterPack" data-price="1500" data-currency="cx">
                        <div class="shop-item-icon"><i class="fas fa-coins"></i></div>
                        <div class="shop-item-title">Starter Pack</div>
                        <div class="shop-item-desc">500 CX + Energy Refill</div>
                        <div class="shop-item-price">
                            <span class="currency-badge cx-badge"><i class="fas fa-coins"></i> 1500 CX</span>
                        </div>
                    </div>
                    <div class="shop-item" data-id="premiumPack" data-price="5000" data-currency="cx">
                        <div class="shop-item-icon"><i class="fas fa-crown"></i></div>
                        <div class="shop-item-title">Premium Pack</div>
                        <div class="shop-item-desc">Permanent +1 Tap</div>
                        <div class="shop-item-price">
                            <span class="currency-badge cx-badge"><i class="fas fa-coins"></i> 5000 CX</span>
                        </div>
                    </div>
                    <div class="shop-item" data-id="dragonPack" data-price="10000" data-currency="cx">
                        <div class="shop-item-icon"><i class="fas fa-dragon"></i></div>
                        <div class="shop-item-title">Dragon Pack</div>
                        <div class="shop-item-desc">2x Multiplier (1h)</div>
                        <div class="shop-item-price">
                            <span class="currency-badge cx-badge"><i class="fas fa-coins"></i> 10000 CX</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeShopModal">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="tasksModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Daily Tasks</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="task-items">
                    <div class="task-item">
                        <div class="task-item-check"></div>
                        <div class="task-item-content">
                            <div class="task-item-title">Mine 100 times</div>
                            <div class="task-item-desc">Tap the mining core 100 times</div>
                        </div>
                        <div class="task-item-reward">+20 CX</div>
                    </div>
                    <div class="task-item">
                        <div class="task-item-check"></div>
                        <div class="task-item-content">
                            <div class="task-item-title">Reach 500 CX</div>
                            <div class="task-item-desc">Accumulate 500 CX in your balance</div>
                        </div>
                        <div class="task-item-reward">+50 CX</div>
                    </div>
                    <div class="task-item">
                        <div class="task-item-check"></div>
                        <div class="task-item-content">
                            <div class="task-item-title">Invite a Friend</div>
                            <div class="task-item-desc">Share your referral link</div>
                        </div>
                        <div class="task-item-reward">+100 CX</div>
                    </div>
                    <div class="task-item">
                        <div class="task-item-check completed"></div>
                        <div class="task-item-content">
                            <div class="task-item-title">Connect Wallet</div>
                            <div class="task-item-desc">Connect your TON wallet</div>
                        </div>
                        <div class="task-item-reward">+30 CX</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeTasksModal">Close</button>
                <button class="btn">Claim All</button>
            </div>
        </div>
    </div>

    <div class="modal" id="leaderboardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Leaderboard</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="leaderboard" id="leaderboardList">
                    <!-- Leaderboard will be populated dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeLeaderboardModal">Close</button>
            </div>
        </div>
    </div>

    <div class="modal" id="notificationsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Notifications</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="notification-items" id="notificationsList">
                    <!-- Notifications will be populated dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeNotificationsModal">Close</button>
                <button class="btn" id="clearNotifications">Clear All</button>
            </div>
        </div>
    </div>

    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Your Profile</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <img class="user-avatar" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" alt="Profile" style="width: 80px; height: 80px;">
                    <h3 id="modalUsername">User</h3>
                    <p>Level <span class="level-badge">1</span></p>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                    <div style="background: var(--bg-tertiary); padding: 15px; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700;" id="modalTotalTaps">0</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Taps</div>
                    </div>
                    <div style="background: var(--bg-tertiary); padding: 15px; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700;" id="modalEarned">0</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Earned</div>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">Wallet Balances</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div style="background: var(--bg-tertiary); padding: 15px; border-radius: var(--radius-md); text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 700; color: #0088cc;" id="modalTonBalance">0 TON</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">TON Balance</div>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 15px; border-radius: var(--radius-md); text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 700; color: #FFD700;" id="modalStarBalance">0 Stars</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Star Balance</div>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">Referral Link</h4>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="referralLinkInput" value="https://t.me/Official_CloneX_Bot?start=ref123" readonly style="flex: 1; background: var(--bg-tertiary); border: 1px solid var(--card-border); border-radius: var(--radius-md); padding: 10px; color: var(--text-primary);">
                        <button class="btn btn-sm" id="copyReferralBtn">Copy</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeProfileModal">Close</button>
                <button class="btn" id="shareProfileBtn">Share Profile</button>
            </div>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">Sound Effects</h4>
                    <label style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Enable Sounds</span>
                        <input type="checkbox" id="soundToggle">
                    </label>
                </div>
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">Vibration</h4>
                    <label style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Enable Vibration</span>
                        <input type="checkbox" id="vibrationToggle">
                    </label>
                </div>
                <div>
                    <h4 style="margin-bottom: 10px;">Language</h4>
                    <select style="width: 100%; background: var(--bg-tertiary); border: 1px solid var(--card-border); border-radius: var(--radius-md); padding: 10px; color: var(--text-primary);">
                        <option>English</option>
                        <option>Russian</option>
                        <option>Spanish</option>
                        <option>Chinese</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeSettingsModal">Cancel</button>
                <button class="btn" id="saveSettingsBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="app">
        <div class="particle-effects" id="particleEffects"></div>
        <div class="tap-effects" id="tapEffects"></div>
        
        <div class="header">
            <div class="user-profile" id="profileBtn">
                <img class="user-avatar" id="profilePic" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" alt="Profile">
                <div class="user-info">
                    <div class="username" id="usernameDisplay">User</div>
                    <div class="user-level">Level <span class="level-badge">1</span></div>
                </div>
            </div>
            
            <div class="header-actions">
                <div class="action-btn" id="walletBtn" title="Wallet">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="action-btn" id="notificationsBtn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <div class="notification-badge">3</div>
                </div>
                <div class="action-btn" id="settingsBtn" title="Settings">
                    <i class="fas fa-cog"></i>
                </div>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-hand-point-up"></i></div>
                <div class="stat-value" id="multitapStat">1</div>
                <div class="stat-label">Multitap</div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                <div class="stat-value" id="energyRegenStat">0.5/s</div>
                <div class="stat-label">Regen</div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div class="stat-value" id="totalTapsStat">0</div>
                <div class="stat-label">Total Taps</div>
            </div>
        </div>

        <div class="balance-section">
            <div class="balance-label">Your Balance</div>
            <div class="balance-amount">
                <img class="currency-icon" src="https://i.postimg.cc/fRwD0tzJ/Adobe-Express-file.png" alt="CX">
                <span id="pointsBalance">0</span>
            </div>
        </div>

        <main class="game-area">
            <div id="multiplierBadge" class="multiplier-badge" style="display: none;">2x Active</div>
            
            <div class="mining-object" id="miningObject">
                <div class="mining-core">
                    <div class="mining-core-inner">
                        <img class="cx-logo" src="https://i.postimg.cc/fRwD0tzJ/Adobe-Express-file.png" alt="CX">
                    </div>
                </div>
            </div>
        </main>

        <div class="energy-section">
            <div class="energy-header">
                <span><i class="fas fa-bolt"></i> Energy</span>
                <span id="energyDisplay">100 / 100</span>
            </div>
            <div class="energy-bar">
                <div id="energyBarFill" class="energy-fill" style="width:100%"></div>
            </div>
        </div>

        <footer class="nav">
            <div class="nav-item active" id="boostsBtn">
                <div class="nav-icon"><i class="fas fa-rocket"></i></div>
                <div class="nav-label">Boosts</div>
            </div>
            <div class="nav-item" id="shopBtn">
                <div class="nav-icon"><i class="fas fa-store"></i></div>
                <div class="nav-label">Shop</div>
            </div>
            <div class="nav-item" id="tasksBtn">
                <div class="nav-icon"><i class="fas fa-tasks"></i></div>
                <div class="nav-label">Tasks</div>
            </div>
            <div class="nav-item" id="leaderboardBtn">
                <div class="nav-icon"><i class="fas fa-trophy"></i></div>
                <div class="nav-label">Rank</div>
            </div>
        </footer>
    </div>

    <script>
    // Game state
    let gameState = {
        points: 0,
        energy: 100,
        maxEnergy: 100,
        energyRegen: 0.5,
        multitap: 1,
        totalTaps: 0,
        level: 1,
        multiplierActive: false,
        multiplierTime: 0,
        walletConnected: false,
        lastSave: Date.now(),
        tonBalance: 0,
        starBalance: 0,
        soundEnabled: false,
        vibrationEnabled: false,
        referralCode: "ref" + Math.floor(1000 + Math.random() * 9000),
        notifications: [
            {
                id: 1,
                title: "Welcome to CloneX!",
                message: "Start tapping to earn CX coins. Connect your wallet to purchase boosts.",
                time: new Date().toISOString(),
                read: false
            },
            {
                id: 2,
                title: "Daily Bonus Available",
                message: "Claim your daily bonus of 50 CX coins in the tasks section.",
                time: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                read: false
            },
            {
                id: 3,
                title: "New Boost Available",
                message: "2x Multiplier boost is now available in the shop for 2000 CX.",
                time: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
                read: true
            }
        ],
        leaderboard: [
            { username: "CryptoKing", points: 12500, level: 25, avatar: "https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" },
            { username: "MinerMax", points: 10800, level: 23, avatar: "https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" },
            { username: "TapMaster", points: 9200, level: 21, avatar: "https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" },
            { username: "User", points: 0, level: 1, avatar: "https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" }
        ]
    };

    // TON Connect connector
    let connector = null;

    // Sound effects
    const tapSound = new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU");
    const purchaseSound = new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU");
    const levelUpSound = new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU");

    // Toast notification system
    function showToast(message, type = 'info', title = null) {
        const toast = document.getElementById('toast');
        const toastContainer = document.getElementById('toastContainer');
        const toastIcon = toast.querySelector('.toast-icon');
        const toastTitle = toast.querySelector('.toast-title');
        const toastMessage = toast.querySelector('.toast-message');
        
        // Set toast content
        toastMessage.textContent = message;
        
        // Set title based on type if not provided
        if (!title) {
            switch(type) {
                case 'success': title = 'Success'; break;
                case 'error': title = 'Error'; break;
                case 'warning': title = 'Warning'; break;
                default: title = 'Information';
            }
        }
        toastTitle.textContent = title;
        
        // Set icon based on type
        let iconClass = 'fas fa-info-circle';
        switch(type) {
            case 'success': iconClass = 'fas fa-check-circle'; break;
            case 'error': iconClass = 'fas fa-exclamation-circle'; break;
            case 'warning': iconClass = 'fas fa-exclamation-triangle'; break;
        }
        toastIcon.innerHTML = `<i class="${iconClass}"></i>`;
        
        // Set toast class
        toast.className = 'toast';
        toast.classList.add(`toast-${type}`);
        
        // Show toast
        toast.classList.add('show');
        
        // Auto hide after 5 seconds
        setTimeout(() => {
            hideToast();
        }, 5000);
    }
    
    function hideToast() {
        const toast = document.getElementById('toast');
        toast.classList.remove('show');
    }
    
    // Play sound effect
    function playSound(sound) {
        if (gameState.soundEnabled) {
            sound.currentTime = 0;
            sound.play().catch(e => console.log("Audio play failed:", e));
        }
    }
    
    // Vibrate device
    function vibrate(pattern = 50) {
        if (gameState.vibrationEnabled && navigator.vibrate) {
            navigator.vibrate(pattern);
        }
    }
    
    // Create tap effect
    function createTapEffect(x, y) {
        const tapEffect = document.createElement('div');
        tapEffect.className = 'tap-effect';
        tapEffect.style.left = `${x}px`;
        tapEffect.style.top = `${y}px`;
        document.getElementById('tapEffects').appendChild(tapEffect);
        
        // Remove effect after animation completes
        setTimeout(() => {
            tapEffect.remove();
        }, 500);
    }
    
    // Create particle effects
    function createParticles(x, y, count = 8) {
        for (let i = 0; i < count; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            // Random angle and distance
            const angle = (i / count) * Math.PI * 2;
            const distance = 50 + Math.random() * 50;
            
            // Calculate target position
            const tx = Math.cos(angle) * distance;
            const ty = Math.sin(angle) * distance;
            
            // Set custom properties
            particle.style.setProperty('--tx', `${tx}px`);
            particle.style.setProperty('--ty', `${ty}px`);
            
            // Position at click
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            
            document.getElementById('particleEffects').appendChild(particle);
            
            // Remove after animation
            setTimeout(() => {
                particle.remove();
            }, 1000);
        }
    }
    
    // Handle mining click
    function handleMiningClick(e) {
        if (gameState.energy < 1) {
            showToast('Not enough energy!', 'error');
            return;
        }
        
        // Calculate click position
        const rect = e.currentTarget.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        // Create effects
        createTapEffect(e.clientX, e.clientY);
        createParticles(e.clientX, e.clientY);
        
        // Play sound and vibration
        playSound(tapSound);
        vibrate(50);
        
        // Deduct energy
        gameState.energy = Math.max(0, gameState.energy - 1);
        updateEnergyDisplay();
        
        // Calculate points earned
        let pointsEarned = gameState.multitap;
        if (gameState.multiplierActive) {
            pointsEarned *= 2;
        }
        
        // Add points
        gameState.points += pointsEarned;
        gameState.totalTaps += 1;
        
        // Update displays
        updatePointsDisplay();
        updateTotalTapsDisplay();
        
        // Show earning text
        showToast(`+${pointsEarned} CX`, 'success');
        
        // Check for level up
        checkLevelUp();
        
        // Save game state
        saveGameState();
    }
    
    // Update points display
    function updatePointsDisplay() {
        document.getElementById('pointsBalance').textContent = Math.floor(gameState.points);
        document.getElementById('modalEarned').textContent = Math.floor(gameState.points);
        
        // Update leaderboard with current user's points
        const userIndex = gameState.leaderboard.findIndex(player => player.username === "User");
        if (userIndex !== -1) {
            gameState.leaderboard[userIndex].points = Math.floor(gameState.points);
            gameState.leaderboard[userIndex].level = gameState.level;
        }
    }
    
    // Update energy display
    function updateEnergyDisplay() {
        const energyPercent = (gameState.energy / gameState.maxEnergy) * 100;
        document.getElementById('energyBarFill').style.width = `${energyPercent}%`;
        document.getElementById('energyDisplay').textContent = `${Math.floor(gameState.energy)} / ${gameState.maxEnergy}`;
    }
    
    // Update energy regen display with fixed decimal places
    function updateEnergyRegenDisplay() {
        // Fix the floating point precision issue
        const cleanRegenValue = parseFloat(gameState.energyRegen.toFixed(1));
        document.getElementById('energyRegenStat').textContent = `${cleanRegenValue}/s`;
    }
    
    // Update total taps display
    function updateTotalTapsDisplay() {
        document.getElementById('totalTapsStat').textContent = gameState.totalTaps;
        document.getElementById('modalTotalTaps').textContent = gameState.totalTaps;
    }
    
    // Update wallet balances display
    function updateWalletDisplay() {
        document.getElementById('modalTonBalance').textContent = `${gameState.tonBalance.toFixed(2)} TON`;
        document.getElementById('modalStarBalance').textContent = `${gameState.starBalance} Stars`;
    }
    
    // Update referral link
    function updateReferralLink() {
        document.getElementById('referralLinkInput').value = `https://t.me/Official_CloneX_Bot?start=${gameState.referralCode}`;
    }
    
    // Check for level up
    function checkLevelUp() {
        const oldLevel = gameState.level;
        const newLevel = Math.floor(gameState.totalTaps / 1000) + 1;
        
        if (newLevel > oldLevel) {
            gameState.level = newLevel;
            document.querySelector('.level-badge').textContent = newLevel;
            
            // Play level up sound and vibration
            playSound(levelUpSound);
            vibrate([100, 50, 100]);
            
            showToast(`Level Up! You're now level ${newLevel}`, 'success', 'Congratulations!');
            
            // Reward user with stars on level up (like other Telegram games)
            gameState.starBalance += 5;
            updateWalletDisplay();
            showToast(`+5 Stars for leveling up!`, 'success');
        }
    }
    
    // Energy regeneration
    function regenerateEnergy() {
        if (gameState.energy < gameState.maxEnergy) {
            gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + gameState.energyRegen / 10);
            updateEnergyDisplay();
            
            // Save game state periodically
            if (Date.now() - gameState.lastSave > 10000) { // Save every 10 seconds
                saveGameState();
                gameState.lastSave = Date.now();
            }
        }
    }
    
    // Multiplier timer
    function updateMultiplier() {
        if (gameState.multiplierActive) {
            gameState.multiplierTime -= 0.1;
            
            if (gameState.multiplierTime <= 0) {
                gameState.multiplierActive = false;
                document.getElementById('multiplierBadge').style.display = 'none';
                showToast('2x Multiplier has expired', 'info');
            }
        }
    }
    
    // Initialize TON Connect properly
    async function initTONConnect() {
        try {
            // Create a connector instance
            connector = new TonConnectSDK.TonConnect({
                manifestUrl: 'https://muntasil79.github.io/Cx-Miner/tonconnect-manifest.json'
            });
            
            // Check if connection is already restored
            if (connector.connected) {
                gameState.walletConnected = true;
                document.getElementById('walletBtn').classList.add('wallet-connected');
                
                // Get wallet information
                const walletInfo = connector.wallet;
                if (walletInfo) {
                    // Fetch real balance from blockchain
                    await fetchRealBalances(walletInfo.account.address);
                }
            }
            
            // Subscribe to connection changes
            connector.onStatusChange(async walletInfo => {
                if (walletInfo) {
                    gameState.walletConnected = true;
                    document.getElementById('walletBtn').classList.add('wallet-connected');
                    document.getElementById('disconnectWallet').style.display = 'block';
                    
                    // Fetch real balances
                    await fetchRealBalances(walletInfo.account.address);
                    
                    showToast('Wallet connected successfully', 'success');
                } else {
                    gameState.walletConnected = false;
                    document.getElementById('walletBtn').classList.remove('wallet-connected');
                    document.getElementById('disconnectWallet').style.display = 'none';
                    gameState.tonBalance = 0;
                    updateWalletDisplay();
                }
            });
            
        } catch (error) {
            console.error('TON Connect initialization failed:', error);
            showToast('Failed to initialize wallet connection', 'error');
        }
    }
    
    // Fetch real balances from blockchain
    async function fetchRealBalances(walletAddress) {
        try {
            // Show loading state
            document.getElementById('walletConnectionStatus').style.display = 'block';
            document.getElementById('walletStatusText').textContent = 'Fetching balances...';
            
            // Fetch TON balance
            const tonResponse = await fetch(`https://toncenter.com/api/v2/getAddressInformation?address=${walletAddress}`);
            const tonData = await tonResponse.json();
            
            if (tonData.result && tonData.result.balance) {
                // Convert nanoton to TON
                gameState.tonBalance = tonData.result.balance / 1000000000;
                updateWalletDisplay();
                document.getElementById('walletStatusText').textContent = 'Balances updated successfully!';
            } else {
                document.getElementById('walletStatusText').textContent = 'Failed to fetch balances';
            }
            
            // Hide loading state after a delay
            setTimeout(() => {
                document.getElementById('walletConnectionStatus').style.display = 'none';
            }, 2000);
            
        } catch (error) {
            console.error('Failed to fetch balances:', error);
            document.getElementById('walletStatusText').textContent = 'Error fetching balances';
            showToast('Failed to fetch wallet balances', 'error');
        }
    }
    
    // Purchase item with CX coins
    function purchaseItem(itemId, price, currency) {
        if (currency === 'cx') {
            if (gameState.points >= price) {
                gameState.points -= price;
                applyItemEffect(itemId);
                updatePointsDisplay();
                saveGameState();
                
                // Play purchase sound and vibration
                playSound(purchaseSound);
                vibrate([100, 50, 100]);
                
                showToast(`Purchase successful! -${price} CX`, 'success');
                return true;
            } else {
                showToast(`Not enough CX for this purchase`, 'error');
                return false;
            }
        }
        
        showToast('Invalid currency type', 'error');
        return false;
    }
    
    // Apply item effect
    function applyItemEffect(itemId) {
        switch(itemId) {
            case 'energyRegen':
                gameState.energyRegen += 0.2;
                updateEnergyRegenDisplay();
                break;
            case 'multitap':
                gameState.multitap += 1;
                document.getElementById('multitapStat').textContent = gameState.multitap;
                break;
            case 'multiplier':
                gameState.multiplierActive = true;
                gameState.multiplierTime = 1800; // 30 minutes in seconds
                document.getElementById('multiplierBadge').style.display = 'block';
                break;
            case 'energyPack':
                gameState.energy = gameState.maxEnergy;
                updateEnergyDisplay();
                break;
            case 'starterPack':
                gameState.points += 500;
                gameState.energy = gameState.maxEnergy;
                updatePointsDisplay();
                updateEnergyDisplay();
                break;
            case 'premiumPack':
                gameState.multitap += 1;
                document.getElementById('multitapStat').textContent = gameState.multitap;
                break;
            case 'dragonPack':
                gameState.multiplierActive = true;
                gameState.multiplierTime = 3600; // 1 hour in seconds
                document.getElementById('multiplierBadge').style.display = 'block';
                break;
        }
    }
    
    // Update leaderboard
    function updateLeaderboard() {
        const leaderboardList = document.getElementById('leaderboardList');
        leaderboardList.innerHTML = '';
        
        // Sort leaderboard by points
        const sortedLeaderboard = [...gameState.leaderboard].sort((a, b) => b.points - a.points);
        
        sortedLeaderboard.forEach((player, index) => {
            const rank = index + 1;
            const leaderboardItem = document.createElement('div');
            leaderboardItem.className = 'leaderboard-item';
            
            leaderboardItem.innerHTML = `
                <div class="leaderboard-rank">${rank}</div>
                <img class="leaderboard-avatar" src="${player.avatar}" alt="${player.username}">
                <div class="leaderboard-info">
                    <div class="leaderboard-name">${player.username}</div>
                    <div class="leaderboard-value">Level ${player.level}</div>
                </div>
                <div class="leaderboard-score">${player.points.toLocaleString()} CX</div>
            `;
            
            leaderboardList.appendChild(leaderboardItem);
        });
    }
    
    // Update notifications
    function updateNotifications() {
        const notificationsList = document.getElementById('notificationsList');
        notificationsList.innerHTML = '';
        
        // Sort notifications by time (newest first)
        const sortedNotifications = [...gameState.notifications].sort((a, b) => new Date(b.time) - new Date(a.time));
        
        sortedNotifications.forEach(notification => {
            const notificationItem = document.createElement('div');
            notificationItem.className = `notification-item ${notification.read ? '' : 'unread'}`;
            
            const timeAgo = getTimeAgo(new Date(notification.time));
            
            notificationItem.innerHTML = `
                <div class="notification-icon"><i class="fas fa-bell"></i></div>
                <div class="notification-content">
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-message">${notification.message}</div>
                    <div class="notification-time">${timeAgo}</div>
                </div>
            `;
            
            notificationItem.addEventListener('click', () => {
                notification.read = true;
                notificationItem.classList.remove('unread');
                updateNotificationBadge();
                saveGameState();
            });
            
            notificationsList.appendChild(notificationItem);
        });
        
        updateNotificationBadge();
    }
    
    // Update notification badge
    function updateNotificationBadge() {
        const unreadCount = gameState.notifications.filter(n => !n.read).length;
        const badge = document.querySelector('.notification-badge');
        
        if (unreadCount > 0) {
            badge.textContent = unreadCount;
            badge.style.display = 'flex';
        } else {
            badge.style.display = 'none';
        }
    }
    
    // Get time ago string
    function getTimeAgo(date) {
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        
        if (diffInSeconds < 60) {
            return 'Just now';
        } else if (diffInSeconds < 3600) {
            const minutes = Math.floor(diffInSeconds / 60);
            return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
        } else if (diffInSeconds < 86400) {
            const hours = Math.floor(diffInSeconds / 3600);
            return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
        } else {
            const days = Math.floor(diffInSeconds / 86400);
            return `${days} day${days !== 1 ? 's' : ''} ago`;
        }
    }
    
    // Save game state to localStorage
    function saveGameState() {
        localStorage.setItem('cloneX_save', JSON.stringify({
            points: gameState.points,
            energy: gameState.energy,
            maxEnergy: gameState.maxEnergy,
            energyRegen: gameState.energyRegen,
            multitap: gameState.multitap,
            totalTaps: gameState.totalTaps,
            level: gameState.level,
            multiplierActive: gameState.multiplierActive,
            multiplierTime: gameState.multiplierTime,
            walletConnected: gameState.walletConnected,
            tonBalance: gameState.tonBalance,
            starBalance: gameState.starBalance,
            soundEnabled: gameState.soundEnabled,
            vibrationEnabled: gameState.vibrationEnabled,
            referralCode: gameState.referralCode,
            notifications: gameState.notifications,
            leaderboard: gameState.leaderboard
        }));
    }
    
    // Load game state from localStorage
    function loadGameState() {
        const saved = localStorage.getItem('cloneX_save');
        if (saved) {
            try {
                const savedState = JSON.parse(saved);
                // Merge with current state
                gameState = {...gameState, ...savedState};
                
                // Update UI with loaded state
                updatePointsDisplay();
                updateEnergyDisplay();
                updateEnergyRegenDisplay();
                updateTotalTapsDisplay();
                updateWalletDisplay();
                updateReferralLink();
                updateLeaderboard();
                updateNotifications();
                
                // Update settings toggles
                document.getElementById('soundToggle').checked = gameState.soundEnabled;
                document.getElementById('vibrationToggle').checked = gameState.vibrationEnabled;
                
                document.querySelector('.level-badge').textContent = gameState.level;
                
                if (gameState.multiplierActive) {
                    document.getElementById('multiplierBadge').style.display = 'block';
                }
                
                if (gameState.walletConnected) {
                    document.getElementById('walletBtn').classList.add('wallet-connected');
                    document.getElementById('disconnectWallet').style.display = 'block';
                }
                
                showToast('Game progress loaded', 'success');
            } catch (e) {
                console.error('Error loading saved game:', e);
            }
        }
    }
    
    // Initialize Telegram Web App
    function initTelegram() {
        try {
            const tg = window.Telegram.WebApp;
            tg.expand();
            tg.enableClosingConfirmation();
            
            // Set up user data
            const user = tg.initDataUnsafe?.user;
            if (user) {
                document.getElementById('usernameDisplay').textContent = user.first_name || 'User';
                document.getElementById('modalUsername').textContent = user.first_name || 'User';
                
                if (user.photo_url) {
                    document.getElementById('profilePic').src = user.photo_url;
                }
            }
            
            return tg;
        } catch (error) {
            console.error('Telegram Web App not available:', error);
            return null;
        }
    }
    
    // Initialize the game
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Telegram
        const tg = initTelegram();
        
        // Load saved game state
        loadGameState();
        
        // Initialize TON Connect
        initTONConnect();
        
        // Set up modal buttons
        document.getElementById('walletBtn').addEventListener('click', function() {
            document.getElementById('walletModal').classList.add('show');
        });
        
        document.getElementById('notificationsBtn').addEventListener('click', function() {
            document.getElementById('notificationsModal').classList.add('show');
        });
        
        document.getElementById('profileBtn').addEventListener('click', function() {
            document.getElementById('modalTotalTaps').textContent = gameState.totalTaps;
            document.getElementById('modalEarned').textContent = Math.floor(gameState.points);
            updateWalletDisplay();
            document.getElementById('profileModal').classList.add('show');
        });
        
        document.getElementById('settingsBtn').addEventListener('click', function() {
            document.getElementById('settingsModal').classList.add('show');
        });
        
        document.getElementById('boostsBtn').addEventListener('click', function() {
            document.getElementById('boostsModal').classList.add('show');
        });
        
        document.getElementById('shopBtn').addEventListener('click', function() {
            document.getElementById('shopModal').classList.add('show');
        });
        
        document.getElementById('tasksBtn').addEventListener('click', function() {
            document.getElementById('tasksModal').classList.add('show');
        });
        
        document.getElementById('leaderboardBtn').addEventListener('click', function() {
            updateLeaderboard();
            document.getElementById('leaderboardModal').classList.add('show');
        });
        
        // Set up wallet connection buttons
        document.getElementById('connectTonKeeper').addEventListener('click', function() {
            if (connector) {
                const universalLink = connector.connect({
                    tonkeeper: 'tonkeeper' 
                });
                window.open(universalLink, '_blank');
            }
        });
        
        document.getElementById('connectTonHub').addEventListener('click', function() {
            if (connector) {
                const universalLink = connector.connect({
                    tonhub: 'tonhub'
                });
                window.open(universalLink, '_blank');
            }
        });
        
        document.getElementById('connectTelegramWallet').addEventListener('click', function() {
            showToast('Telegram wallet integration coming soon', 'info');
        });
        
        document.getElementById('disconnectWallet').addEventListener('click', function() {
            if (connector) {
                connector.disconnect();
                gameState.walletConnected = false;
                document.getElementById('walletBtn').classList.remove('wallet-connected');
                this.style.display = 'none';
                gameState.tonBalance = 0;
                updateWalletDisplay();
                showToast('Wallet disconnected', 'info');
            }
        });
        
        // Set up purchase buttons
        document.querySelectorAll('.boost-item').forEach(item => {
            item.addEventListener('click', function() {
                const itemId = this.getAttribute('data-id');
                const price = parseFloat(this.getAttribute('data-price'));
                const currency = this.getAttribute('data-currency');
                
                purchaseItem(itemId, price, currency);
            });
        });
        
        document.querySelectorAll('.shop-item').forEach(item => {
            item.addEventListener('click', function() {
                const itemId = this.getAttribute('data-id');
                const price = parseFloat(this.getAttribute('data-price'));
                const currency = this.getAttribute('data-currency');
                
                purchaseItem(itemId, price, currency);
            });
        });
        
        // Copy referral link
        document.getElementById('copyReferralBtn').addEventListener('click', function() {
            const referralInput = document.getElementById('referralLinkInput');
            referralInput.select();
            document.execCommand('copy');
            showToast('Referral link copied to clipboard!', 'success');
        });
        
        // Share profile
        document.getElementById('shareProfileBtn').addEventListener('click', function() {
            if (navigator.share) {
                navigator.share({
                    title: 'CloneX Game',
                    text: `Check out my CloneX progress! I've earned ${gameState.points} CX coins!`,
                    url: document.getElementById('referralLinkInput').value
                }).catch(console.error);
            } else {
                showToast('Web Share API not supported in your browser', 'info');
            }
        });
        
        // Save settings
        document.getElementById('saveSettingsBtn').addEventListener('click', function() {
            gameState.soundEnabled = document.getElementById('soundToggle').checked;
            gameState.vibrationEnabled = document.getElementById('vibrationToggle').checked;
            saveGameState();
            showToast('Settings saved successfully', 'success');
            document.getElementById('settingsModal').classList.remove('show');
        });
        
        // Close modal buttons
        document.getElementById('closeWalletModal').addEventListener('click', function() {
            document.getElementById('walletModal').classList.remove('show');
        });
        
        document.getElementById('closeNotificationsModal').addEventListener('click', function() {
            document.getElementById('notificationsModal').classList.remove('show');
        });
        
        document.getElementById('clearNotifications').addEventListener('click', function() {
            gameState.notifications = [];
            updateNotifications();
            saveGameState();
        });
        
        document.getElementById('closeProfileModal').addEventListener('click', function() {
            document.getElementById('profileModal').classList.remove('show');
        });
        
        document.getElementById('closeSettingsModal').addEventListener('click', function() {
            document.getElementById('settingsModal').classList.remove('show');
        });
        
        document.getElementById('closeBoostsModal').addEventListener('click', function() {
            document.getElementById('boostsModal').classList.remove('show');
        });
        
        document.getElementById('closeShopModal').addEventListener('click', function() {
            document.getElementById('shopModal').classList.remove('show');
        });
        
        document.getElementById('closeTasksModal').addEventListener('click', function() {
            document.getElementById('tasksModal').classList.remove('show');
        });
        
        document.getElementById('closeLeaderboardModal').addEventListener('click', function() {
            document.getElementById('leaderboardModal').classList.remove('show');
        });
        
        const closeButtons = document.querySelectorAll('.modal-close');
        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.classList.remove('show');
                }
            });
        });
        
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                }
            });
        });
        
        // Initialize navigation
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Initialize mining object interaction
        const miningObject = document.getElementById('miningObject');
        if (miningObject) {
            miningObject.addEventListener('click', handleMiningClick);
        }
        
        // Set up game loops
        setInterval(regenerateEnergy, 100);
        setInterval(updateMultiplier, 100);
        
        // Show welcome message
        setTimeout(() => {
            showToast('Welcome to CloneX! Tap the core to earn CX', 'info', 'Welcome');
        }, 1000);
        
        // Initialize toast close button
        document.querySelector('.toast-close').addEventListener('click', hideToast);
    });
    </script>
</body>
</html>